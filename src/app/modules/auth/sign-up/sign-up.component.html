<div
    class="flex min-w-0 flex-auto flex-col items-center sm:flex-row sm:justify-center md:items-stretch md:justify-stretch">
    <!-- LEFT: Quick Quote Section -->
    <div
        class="relative hidden h-full flex-auto items-center justify-center overflow-hidden bg-[#04b2e1] p-16 text-white dark:border-r md:flex lg:px-28">
        <!-- Decorative Rings -->
        <svg class="absolute inset-0 pointer-events-none opacity-20" viewBox="0 0 960 540" width="100%" height="100%"
            preserveAspectRatio="xMidYMax slice" xmlns="http://www.w3.org/2000/svg">
            <g fill="none" stroke="currentColor" stroke-width="100">
                <circle r="234" cx="196" cy="23"></circle>
                <circle r="234" cx="790" cy="491"></circle>
            </g>
        </svg> <!-- Dots --> <!-- prettier-ignore -->
        <marine-quick-quote *ngIf="showMarineQuote" (closeQuote)="showMarineQuote = false"></marine-quick-quote>
        <!-- Quick Quote Content -->
        <div class="relative z-10 w-full max-w-md text-left" *ngIf="!showMarineQuote">
            <h2 class="text-4xl font-extrabold mb-6">Get a Quick Quote</h2>
            <p class="opacity-90 mb-8 text-lg"> Start instantly â€” no login required. Choose a product below to
                begin. </p>
            <div class="flex flex-col gap-4">
                <!-- Marine Insurance card -->
                <div class="flex flex-col items-start gap-3 rounded-2xl bg-white/10 p-4
               sm:flex-row sm:items-center sm:justify-between sm:p-5
               w-full max-w-[560px]">
                    <div class="flex items-start gap-3">
                        <mat-icon class="mt-0.5 text-white">directions_boat</mat-icon>

                        <div>
                            <h3 class="text-base sm:text-lg font-semibold text-white">
                                Marine Insurance
                            </h3>
                            <p class="text-xs sm:text-sm text-white/70">
                                Protect your vessels &amp; cargo
                            </p>
                        </div>
                    </div>

                    <button class="w-full rounded-xl bg-black px-3 py-1.5 sm:px-4 sm:py-2
                   text-center text-xs sm:text-sm font-medium text-white shadow-lg
                   transition-all duration-200 hover:bg-gray-800 md:w-auto" (click)="toggleMarineQuote()">
                        Get Quote
                    </button>
                </div>

                <!-- Travel Insurance card -->
                <div class="flex flex-col items-start gap-3 rounded-2xl bg-white/10 p-4
               sm:flex-row sm:items-center sm:justify-between sm:p-5
               w-full max-w-[560px]">
                    <div class="flex items-start gap-3">
                        <mat-icon class="mt-0.5 text-white">flight_takeoff</mat-icon>

                        <div>
                            <h3 class="text-base sm:text-lg font-semibold text-white">
                                Travel Insurance
                            </h3>
                            <p class="text-xs sm:text-sm text-white/70">
                                Protect your trips from unexpected events
                            </p>
                        </div>
                    </div>

                    <button class="w-full rounded-xl bg-black px-3 py-1.5 sm:px-4 sm:py-2
                   text-center text-xs sm:text-sm font-medium text-white shadow-lg
                   transition-all duration-200 hover:bg-gray-800 md:w-auto" (click)="onTravelQuoteClick()">
                        Get Quote
                    </button>
                </div>
                <!-- Motor Insurance card -->
                <div class="flex flex-col items-start gap-3 rounded-2xl bg-white/10 p-4
               sm:flex-row sm:items-center sm:justify-between sm:p-5
               w-full max-w-[560px]">
                    <div class="flex items-start gap-3">
                        <mat-icon class="mt-0.5 text-white">directions_car</mat-icon>

                        <div>
                            <h3 class="text-base sm:text-lg font-semibold text-white">
                                Motor Insurance
                            </h3>
                            <p class="text-xs sm:text-sm text-white/70">
                                Cover your vehicles against accidents &amp; theft
                            </p>
                        </div>
                    </div>

                    <button class="w-full rounded-xl bg-black px-3 py-1.5 sm:px-4 sm:py-2
                   text-center text-xs sm:text-sm font-medium text-white shadow-lg
                   transition-all duration-200 hover:bg-gray-800 md:w-auto" (click)="onMotorQuoteClick()">
                        Get Quote
                    </button>
                </div>

            </div>
        </div>
    </div>
    <div
        class="w-full px-4 py-10 sm:bg-card sm:w-auto sm:rounded-2xl sm:p-12 sm:shadow md:flex md:h-full md:justify-end md:rounded-none md:p-16 md:shadow-none bg-white">
        <div class="mx-auto w-full max-w-80 sm:mx-0 sm:w-80"> <!-- Logo -->
            <div class="w-full h-20 flex items-center justify-center">
                <img class="h-full w-auto" src="images/logo/logo.svg" alt="Logo" />
            </div> <!-- Title -->
            <div class="mt-8 text-4xl font-extrabold leading-tight tracking-tight text-[#04b2e1]"> Sign up</div>
            <div class="mt-0.5 flex items-baseline font-medium">
                <div>Already have an account?</div>
                <a class="ml-1 text-primary-500 text-[#04b2e1] font-semibold hover:underline" [routerLink]="['/sign-in']">Sign in </a>
            </div>
            <!-- Alert --> @if (showAlert) {
            <fuse-alert class="mt-8" [appearance]="'outline'" [showIcon]="false" [type]="alert.type"
                [@shake]="alert.type === 'error'"> {{ alert.message }}
            </fuse-alert>
            } <!-- Sign Up form -->
            <form [formGroup]="registerForm" novalidate>
                <!-- Account type selection hidden - only Individual allowed -->
                <div class="mb-6">
                    <mat-radio-group class="flex items-center justify-center gap-6" formControlName="accountType">
                        <mat-radio-button value="C" class="text-base font-medium">Individual</mat-radio-button>
                        <mat-radio-button value="A" class="text-base font-medium">Intermediary</mat-radio-button>
                    </mat-radio-group>
                </div>
                <div *ngIf="registerForm && registerForm.get('accountType')?.value === 'C'">
                    <div class="space-y-4">
                        <div><label class="mb-3 block text-sm font-medium text-gray-900">Full Name *</label> <input
                            type="text" autocomplete="off"
                            [class]="'w-full rounded-lg px-4 py-3 text-sm border focus:outline-none focus:ring-2 focus:border-transparent ' + (registerForm.get('fullName')?.invalid && registerForm.get('fullName')?.touched ? 'border-red-500 focus:ring-red-500' : 'border-gray-300 focus:ring-sky-500') + (registerForm.get('fullName')?.value ? ' font-bold' : '')"
                            formControlName="fullName" placeholder="John Doe" />
                            <div *ngIf="registerForm.get('fullName')?.invalid && registerForm.get('fullName')?.touched"
                                 class="mt-1.5 text-xs text-red-500"><span
                                *ngIf="registerForm.get('fullName')?.errors?.['required']">Full name is required</span>
                                <span *ngIf="registerForm.get('fullName')?.errors?.['fullNameInvalid']">Enter at least two names</span>
                            </div>
                        </div>
                        <div><label class="mb-3 block text-base font-medium text-gray-900">Email Address *</label> <input
                                type="email" autocomplete="off"
                                [class]="'w-full rounded-lg px-4 py-3.5 text-sm border focus:outline-none focus:ring-2 focus:border-transparent ' + (registerForm.get('email')?.invalid && registerForm.get('email')?.touched ? 'border-red-500 focus:ring-red-500' : 'border-gray-300 focus:ring-sky-500')"
                                formControlName="email" placeholder="your-email@example.com" />
                            <div *ngIf="registerForm.get('email')?.invalid && registerForm.get('email')?.touched"
                                class="mt-1.5 text-xs text-red-500"><span
                                    *ngIf="registerForm.get('email')?.errors?.['required']">Email is required</span>
                                <span *ngIf="registerForm.get('email')?.errors?.['email']">Enter a valid email</span>
                            </div>
                        </div>
                        <div><label class="mb-3 block text-base font-medium text-gray-900">Phone Number *</label> <input
                                type="tel" autocomplete="off"
                                [class]="'w-full rounded-lg px-4 py-3.5 text-sm border focus:outline-none focus:ring-2 focus:border-transparent ' + (registerForm.get('phoneNumber')?.invalid && registerForm.get('phoneNumber')?.touched ? 'border-red-500 focus:ring-red-500' : 'border-gray-300 focus:ring-sky-500')"
                                formControlName="phoneNumber" placeholder="+254712345678"
                                (input)="onPhoneNumberChange($event)" maxlength="13" />
                            <div *ngIf="registerForm.get('phoneNumber')?.invalid && registerForm.get('phoneNumber')?.touched"
                                class="mt-1.5 text-xs text-red-500"><span
                                    *ngIf="registerForm.get('phoneNumber')?.errors?.['required']">Phone is
                                    required</span>
                                <span *ngIf="registerForm.get('phoneNumber')?.errors?.['phoneNumberInvalid']">Use +254
                                    format</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div *ngIf="registerForm && registerForm.get('accountType')?.value === 'A'">
                    <div class="space-y-4">
                        <div>
                            <label class="mb-3 block text-base font-medium text-gray-900">Intermediary - IRA
                                Number *</label>
                            <input
                                type="text"
                                [class]="'w-full rounded-lg px-4 py-3.5 text-sm border bg-white text-gray-900 placeholder-gray-400 transition-colors focus:outline-none focus:ring-2 focus:border-transparent ' +
                                (registerForm.get('iraNumber')?.invalid && registerForm.get('iraNumber')?.touched
                                  ? 'border-red-500 focus:ring-red-500'
                                  : 'border-gray-300 focus:ring-sky-500')"
                                formControlName="iraNumber"
                                placeholder="IRA Number" />
                        </div>
                    </div>
                </div>
                <ng-container *ngIf="registerForm && registerForm.get('accountType')?.value">
                    <div class="mt-6 mb-4">
                        <label class="mb-3 block text-base font-medium text-gray-900">Password *</label>
                        <div class="relative">
                            <input [type]="showPassword ? 'text' : 'password'" autocomplete="off"
                                   [class]="'w-full rounded-lg px-4 py-3.5 pr-12 text-sm border bg-white text-gray-900 placeholder-gray-400 transition-colors focus:outline-none focus:ring-2 focus:border-transparent ' +
                                   (password?.invalid && password?.touched
                                     ? 'border-red-500 focus:ring-red-500'
                                     : 'border-gray-300 focus:ring-sky-500')"
                                   formControlName="password" placeholder="Create a strong password"
                                   required />
                            <button type="button"
                                    class="absolute inset-y-0 right-0 flex items-center pr-4 text-gray-400 hover:text-gray-600 transition-colors"
                                    (click)="togglePasswordVisibility()">
                                <mat-icon class="text-xl">{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                            </button>
                        </div>
                        <div *ngIf="password?.touched && password?.value" class="mt-1">
                            <ul class="space-y-0.5 text-xs text-gray-500">
                                <li class="flex items-center" [class.text-green-600]="hasMinLength(password.value)">
                                    <mat-icon class="text-xs mr-1">{{ hasMinLength(password.value) ? 'check_circle' : 'cancel' }}</mat-icon>
                                    <span class="text-xs">At least 8 characters</span>
                                </li>
                                <li class="flex items-center" [class.text-green-600]="hasLowercase(password.value)">
                                    <mat-icon class="text-xs mr-1">{{ hasLowercase(password.value) ? 'check_circle' : 'cancel' }}</mat-icon>
                                    <span class="text-xs">One lowercase letter</span>
                                </li>
                                <li class="flex items-center" [class.text-green-600]="hasUppercase(password.value)">
                                    <mat-icon class="text-xs mr-1">{{ hasUppercase(password.value) ? 'check_circle' : 'cancel' }}</mat-icon>
                                    <span class="text-xs">One uppercase letter</span>
                                </li>
                                <li class="flex items-center" [class.text-green-600]="hasNumber(password.value)">
                                    <mat-icon class="text-xs mr-1">{{ hasNumber(password.value) ? 'check_circle' : 'cancel' }}</mat-icon>
                                    <span class="text-xs">One number</span>
                                </li>
                                <li class="flex items-center" [class.text-green-600]="hasSpecialChar(password.value)">
                                    <mat-icon class="text-xs mr-1">{{ hasSpecialChar(password.value) ? 'check_circle' : 'cancel' }}</mat-icon>
                                    <span class="text-xs">One special character (&#64;$!%*?&)</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="mb-3 block text-base font-medium text-gray-900">Confirm Password *</label>
                        <div class="relative">
                            <input [type]="showPassword ? 'text' : 'password'" autocomplete="off"
                                   [class]="'w-full rounded-lg px-4 py-3.5 pr-12 text-sm border bg-white text-gray-900 placeholder-gray-400 transition-colors focus:outline-none focus:ring-2 focus:border-transparent ' +
                                   (((confirmPassword?.invalid && confirmPassword?.touched) || (registerForm.errors?.['passwordMismatch'] && confirmPassword?.touched))
                                     ? 'border-red-500 focus:ring-red-500'
                                     : 'border-gray-300 focus:ring-sky-500')"
                                   formControlName="confirmPassword" placeholder="Confirm your password"
                                   required />
                            <button type="button"
                                    class="absolute inset-y-0 right-0 flex items-center pr-4 text-gray-400 hover:text-gray-600 transition-colors"
                                    (click)="togglePasswordVisibility()">
                                <mat-icon class="text-xl">{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
                            </button>
                        </div>
                        <p class="mt-1.5 text-xs text-red-500"
                           *ngIf="registerForm.errors?.['passwordMismatch'] && confirmPassword?.touched">
                            Passwords do not match
                        </p>
                    </div>
                    <div class="mb-5 rounded-md border border-gray-200 bg-white px-3 py-3"
                         [ngClass]="registerForm.get('agreementAccepted')?.invalid && registerForm.get('agreementAccepted')?.touched ? 'border-red-500 bg-red-50' : ''">
                        <div class="flex items-center">
                            <mat-checkbox formControlName="agreementAccepted" id="register-agreement"
                                class="flex-shrink-0"></mat-checkbox>
                            <label for="register-agreement" class="ml-2 text-xs sm:text-sm text-gray-600">I agree to the
                                <a href="#" class="font-medium text-gray-900 hover:underline"
                                    (click)="showTermsModal = true; $event.preventDefault()">Terms of Use</a> and to the
                                <a href="#" class="font-medium text-sky-500 hover:text-sky-600 hover:underline"
                                    (click)="showDataPrivacyModal = true; $event.preventDefault()">Data Privacy Policy</a>.*
                            </label>
                        </div>
                        <p *ngIf="registerForm.get('agreementAccepted')?.invalid && registerForm.get('agreementAccepted')?.touched"
                           class="mt-1 text-xs text-red-600">
                            You must agree to the Terms of Use and Data Privacy Policy to continue.
                        </p>
                    </div>
                    <button type="button" (click)="register()"
                        class="w-full rounded-lg py-3.5 text-base font-semibold transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2"
                        [ngClass]="{
          'bg-primary text-white hover:bg-secondary focus:ring-primary': registerForm.valid && !loading,
          'cursor-not-allowed bg-gray-200 text-gray-400': registerForm.invalid || registerForm.disabled || loading
        }" [disabled]="registerForm.invalid || registerForm.disabled || loading">

                        <ng-container *ngIf="!loading; else registering">
                            Create Account
                        </ng-container>

                        <ng-template #registering>
                            <div class="flex items-center justify-center">
                                <mat-progress-spinner [diameter]="18" mode="indeterminate"
                                    class="mr-2"></mat-progress-spinner>
                                <span>Creating account...</span>
                            </div>
                        </ng-template>
                    </button>

                </ng-container>

            </form>
        </div>
    </div>

    <!-- Data Privacy Policy Modal -->
    <div *ngIf="showDataPrivacyModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 p-2 sm:p-4" (click)="showDataPrivacyModal = false">
        <div class="max-h-[95vh] w-full max-w-4xl overflow-y-auto rounded-lg bg-white shadow-xl" (click)="$event.stopPropagation()">
            <div class="sticky top-0 bg-white border-b border-gray-200 px-3 py-3 sm:px-6 sm:py-4">
                <div class="flex items-center justify-between">
                    <h2 class="text-xl sm:text-2xl md:text-3xl font-bold text-gray-800">Data Privacy Policy</h2>
                    <button (click)="showDataPrivacyModal = false" class="text-gray-400 hover:text-gray-600 p-1">
                        <mat-icon class="text-lg sm:text-xl">close</mat-icon>
                    </button>
                </div>
            </div>
            <div class="px-3 py-4 sm:px-6 sm:py-6">
                <div class="prose max-w-none text-sm sm:text-base md:text-lg text-gray-700">
                    <p class="mb-3 sm:mb-4"><strong>Data Privacy Statement</strong></p>
                    <p class="mb-3 sm:mb-4">Geminia Insurance Company Limited is committed to protecting the fundamental human right to privacy of those with whom we interact. We recognize the need to safeguard personal data that is collected or disclosed to us as part of the Know-your-customer information required by us in order to provide you with the requisite financial product or service.</p>
                    <p class="mb-3 sm:mb-4">We are committed to complying with the requirements of the Data Protection Act and the attendant regulations as well as best global best practices regarding the processing of your personal data. In this regard, you are required to acquaint yourselves with our data privacy statement which is intended to tell you how we use your personal data and describes how we collect and process your personal data during and after your relationship with us.</p>

                    <div class="mt-4 sm:mt-6 rounded-md bg-green-50 px-3 py-3 sm:px-4 sm:py-4 text-xs sm:text-sm text-gray-800 border border-green-100">
                        <div class="font-semibold mb-1">External Link:</div>
                        <p>
                            For complete privacy policy details, please visit:
                            <a href="https://geminia.co.ke/data-privacy-statement/" target="_blank" class="text-sky-500 hover:underline break-all">https://geminia.co.ke/data-privacy-statement/</a>
                        </p>
                    </div>

                    <p class="mt-4 sm:mt-6 text-xs sm:text-sm text-gray-500">Last updated: {{ getCurrentDate() }}</p>
                </div>
            </div>
            <div class="sticky bottom-0 bg-white border-t border-gray-200 px-3 py-3 sm:px-6 sm:py-4">
                <div class="flex justify-end">
                    <button (click)="showDataPrivacyModal = false" class="rounded-md bg-primary px-3 py-2 sm:px-4 text-sm sm:text-base text-white hover:bg-secondary">I Understand</button>
                </div>
            </div>
        </div>
    </div>
</div>
